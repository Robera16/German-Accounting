[
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Item",
  "enabled": 0,
  "modified": "2023-08-30 19:16:43.946538",
  "module": "German Accounting",
  "name": "Item query filter",
  "script": "frappe.ui.form.on('Item', {\n\tonload: function(frm) {\n\t\tfrm.set_query(\"item_group\", function() {\n\t\t\treturn {\n\t\t\t\tfilters: {\n\t\t\t\t\tname: ['in', [\"Sonsige Leistung\", \"Lieferung\"]]\n\t\t\t\t}\n\t\t\t}\n\t\t})\n\t},\n})",
  "view": "Form"
 },
 {
  "docstatus": 0,
  "doctype": "Client Script",
  "dt": "Sales Order",
  "enabled": 1,
  "modified": "2023-08-30 19:48:08.304182",
  "module": "German Accounting",
  "name": "Sales Order Query",
  "script": "frappe.ui.form.on('Sales Order', {\n\tvalidate: function (frm) {\n\t    \n\t    var row;\n\t    var liefbetrag = 0;\n\t    var sonstbetrag = 0;\n\n\n// Here we go through the item table and count the amounts for the two categories\n\t    for(row in frm.doc.items)\n\t    { \n\t        if (frm.doc.items[row].item_group == \"Lieferung\") {liefbetrag += frm.doc.items[row].qty * frm.doc.items[row].price_list_rate}\n\t        if (frm.doc.items[row].item_group == \"Sonstige Leistung\") {sonstbetrag += frm.doc.items[row].qty * frm.doc.items[row].price_list_rate}   \n\t    }\n\n// test which amount is higher...\n\t    if (liefbetrag >= sonstbetrag) {frm.set_value(\"artikelkategorie_nach_amount\",\"Lieferung\")} else {frm.set_value(\"artikelkategorie_nach_amount\",\"Sonstige Leistung\")}\n\n// case distinction for \"text_fuer_druck\"\n\t    if (frm.doc.auswahl_ziel == \"Inland\" && frm.doc.artikelkategorie_nach_amount == \"Lieferung\")\n\t        {frm.set_value(\"text_fuer_druck\",\"19% Ust\")}\n\n\t    if (frm.doc.auswahl_ziel == \"Inland\" && frm.doc.artikelkategorie_nach_amount == \"Sonstige Leistung\")\n\t        {frm.set_value(\"text_fuer_druck\",\"19% Ust\")}\n\n\t    if (frm.doc.auswahl_ziel == \"EU-Ausland\" && frm.doc.artikelkategorie_nach_amount == \"Lieferung\")\n\t        {\n\t            if (frm.doc.ust_id == \"Ja\")\n\t            {frm.set_value(\"text_fuer_druck\",\"0% Ust  \u2013  Steuerfreie innergemeinschaftliche Lieferung\")}\n\t            else\n\t            {frm.set_value(\"text_fuer_druck\",\"19% Ust\")}\n\t        }\n\n\t    if (frm.doc.auswahl_ziel == \"EU-Ausland\" && frm.doc.artikelkategorie_nach_amount == \"Sonstige Leistung\")\n\t        {\n\t            if (frm.doc.ust_id == \"Ja\")\n\t            {frm.set_value(\"text_fuer_druck\",\"0% Ust  \u2013  Steuerfreie innergemeinschaftliche Lieferung (Reverse-Charge-Verfahren)\")}\n\t            else\n\t            {frm.set_value(\"text_fuer_druck\",\"19% Ust\")}\n\t        }\n\n\t    if (frm.doc.auswahl_ziel == \"Drittland\" && frm.doc.artikelkategorie_nach_amount == \"Lieferung\")\n\t        {frm.set_value(\"text_fuer_druck\",\"0% Ust  \u2013  Umsatzsteuerfreie Ausfuhrlieferung\")}\n\t   \n\t    if (frm.doc.auswahl_ziel == \"Drittland\" && frm.doc.artikelkategorie_nach_amount == \"Sonstige Leistung\")\n\t        {\n\t            if (frm.doc.ust_id == \"Ja\")\n\t            {frm.set_value(\"text_fuer_druck\",\"0% Ust  \u2013  Im Inland nicht steuerbare Leistung\")}\n\t            else\n\t            {frm.set_value(\"text_fuer_druck\",\"19% Ust\")}\n\t        }\n\t}\n})",
  "view": "Form"
 }
]